# configuration.properties

This is the main configuration file, with all values specific to the side service.

Here is the detail of the configuration entries:

| Configuration entry                       | Explanation                                                                                                                                                                                                                                                                                | Example                                                                              |
|-------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------|
| mongo.url                                 | Url for the MongoDB server(s). Hold authentication information. If unspecified memory datasructures are used instead.                                                                                                                                                                      | mongo.url=mongodb://esn_docker:zyz@mongo:27017/esn_docker?authSource=esn_docker      |
| mongo.database                            | MongoDB database to use.                                                                                                                                                                                                                                                                   | mongo.database=esn_docker                                                            |
| domains                                   | Coma separated list of domains to be pre provisions.                                                                                                                                                                                                                                       | domains=linagora.com                                                                 |
| rest.api.port                             | Port the rest API (openpaas API partial implementation) should listen on. Optinal: 80 by default                                                                                                                                                                                           | rest.api.port=80                                                                     |
| spa.calendar.url                          | The URL of the Calendar SPA, used to generate links in emails.                                                                                                                                                                                                                             | spa.calendar.url=https://calendar.linagora.com                                       |
| spa.excal.url                             | The URL of the Excal SPA, used to generate links in emails.                                                                                                                                                                                                                                | https://excal.linagora.com                                                           |
| openpaas.backend.url                      | The URL of a OpenPaaS backend. Unhandled calls of the OpenPaaS API are logged then proxied to this URL. This is meant as a temporary way to discover unimplemented OpenPaaS calls performed by the SPA.                                                                                    | openpaas.backend.url=https://openpaas.linagora.com                                   |
| openpaas.backend.trust.all.certificates   | Trust the OpenPaaS SSL certificates. Defaults to false (secure)                                                                                                                                                                                                                            | openpaas.backend.trust.all.certificates=true                                         |
| jwt.key.private                           | A JWT key is used in order to authenticate some calls to the DAV server. this key needs to be common with the dav server, but also to sign participation tokens for excal. Must be a PEM private key                                                                                       | jwt.key.private=file:///root/conf/jwt_privatekey                                     |
| jwt.key.public                            | The corresponding public key. Must be a PEM public key.                                                                                                                                                                                                                                    | jwt.key.public=file:///root/conf/jwt_publickey                                       |
| jwt.key.validity                          | Validity of the JWT token (except excal tokens), optional defaults to 1 day                                                                                                                                                                                                                | jwt.key.validity=1d                                                                  |
| oidc.userInfo.url                         | OIDC userinfo endpoint to use in order to validate and get information on the tokens                                                                                                                                                                                                       | oidc.userInfo.url=https://sso.linagora.com/oauth2/userinfo                           |
| oidc.introspect.url                       | OIDC introspect endpoint to use in order to validate and get the sid of the token, used for back-channel logout.                                                                                                                                                                           | oidc.userInfo.url=https://sso.linagora.com/oauth2/userinfo                           |
| oidc.introspect.credentials               | Credential used to call the introspect service                                                                                                                                                                                                                                             | oidc.introspect.credentials=Basic xxxxxxxxxxxxxxxxxxxxxxxxx                          |
| oidc.introspection.claim                  | Claims to retrieve                                                                                                                                                                                                                                                                         | oidc.introspection.claim=email                                                       |
| oidc.claim                                | Claims to retrieve                                                                                                                                                                                                                                                                         | oidc.claim=email                                                                     |
| oidc.audience                             | Audience to be used upon token validation                                                                                                                                                                                                                                                  | oidc.audience=tcalendar                                                              |
| oidc.fallback.lemon.cookie.resolution.url | Calendar SPA might use lemon cookie. This URL allows resolving those.                                                                                                                                                                                                                      | oidc.fallback.lemon.cookie.resolution.url=https://sso.linagora.com/mysession/?whoami |
| oidc.fallback.lemon.cookie.resolution.url | Domain to use for lemon cookie resolution.                                                                                                                                                                                                                                                 | oidc.fallback.lemon.cookie.resolution.domain=linagora.com                            |
| calendar.sharing.enabled                  | Should the calendar sharing feature be enabled? Default to true                                                                                                                                                                                                                            | calendar.sharing.enabled=true                                                        |
| contacts.sharing.enabled                  | Should the address book sharing feature be enabled? Default to true                                                                                                                                                                                                                        | contacts.sharing.enabled=true                                                        |
| domain.contacts.enabled                   | Should we enable domain address books? Default to true                                                                                                                                                                                                                                     | domain.contacts.enabled=true                                                         |
| default.language                          | Default language to be used if the user has none. Defaults to en (english)                                                                                                                                                                                                                 | default.language=en                                                                  |
| default.timezone                          | Default timezone to be used if the user has none. Defaults to Europe/Paris                                                                                                                                                                                                                 | default.timezone=Europe/Paris                                                        |
| default.business.hours.start              | Default business hour start to be used if the user has none. Defaults to 8:0 (8am)                                                                                                                                                                                                         | default.business.hours.start=8:0                                                     |
| default.business.hours.end                | Default business hour end to be used if the user has none. Defaults to 19:0 (7pm)                                                                                                                                                                                                          | default.business.hours.end=19:0                                                      |
| default.business.hours.daysOfWeek         | Default business days in one week if the user has none. Defaults to 1,2,3,4,5 (monday to friday)                                                                                                                                                                                           | default.business.hours.daysOfWeek=1,2,3,4,5,6                                        |
| default.use.24h.format                    | Should we use a 24 hour format? Defaults to true                                                                                                                                                                                                                                           | default.use.24h.format=true                                                          |
| dav.url                                   | URL of the esn-sabre dav serve                                                                                                                                                                                                                                                             | dav.url=https://dav.linagora.com                                                     |
| dav.admin.user                            | username of the dav admin                                                                                                                                                                                                                                                                  | dav.admin.user=admin                                                                 |
| dav.admin.password                        | Password of the dav admin, to be used to impersonate DAV users                                                                                                                                                                                                                             | dav.admin.password=xxxx                                                              |
| dav.rest.client.response.timeout          | Response timeout for the DAV server HTTP connection pool in ms                                                                                                                                                                                                                             | dav.rest.client.response.timeout=120000                                              |
| smtp.host                                 | SMTP host to be used to send emails                                                                                                                                                                                                                                                        | smtp.host=smtp.linagora.com                                                          |
| smtp.port                                 | SMTP port to be used to send emails                                                                                                                                                                                                                                                        | smtp.port=25                                                                         |
| smtp.helo                                 | Value to advertize in ehlo exchange                                                                                                                                                                                                                                                        | smtp.helo=tcalendar.linagora.com                                                     |
| smtp.username                             | Optional. SMTP authentication setup.                                                                                                                                                                                                                                                       | smtp.username=tcalendar                                                              |
| smtp.password                             | Optional. SMTP authentication setup.                                                                                                                                                                                                                                                       | smtp.password=xxxxxxx                                                                |
| smtp.ssl.enabled                          | Optional. SMTP SSL setup.                                                                                                                                                                                                                                                                  | smtp.ssl.enabled=true                                                                |
| smtp.starttls.enabled                     | Optional. SMTP startTLS setup. Prefer SSL.                                                                                                                                                                                                                                                 | smtp.starttls.enabled=true                                                           |
| smtp.ssl.trustAllCerts                    | Optional. Defaults to false (secure).                                                                                                                                                                                                                                                      | smtp.ssl.trustAllCerts=false                                                         |
| mail.template.location                    | Allow for custom email template location if needed.                                                                                                                                                                                                                                        | mail.template.location=file://root/resources/template                                |
| mail.sender                               | From value to position in emails, when needed.                                                                                                                                                                                                                                             | mail.sender=no-reply@linagora.com                                                    |
| mail.imip.recipient.whitelist             | Controls who receives email generated b the calendar (coma separated list of email address). Default toeveryone if ommitted. Usefull if the side service is deployed along side an openpaas server it wishes to replace.                                                                   | mail.imip.recipient.whitelist=btellier@linagora.com,hphan@linagora.com               |
| admin.username                            | Optional. Used by Twake mail to access the OpenPaaS API for its DAV extension.                                                                                                                                                                                                             | admin.username=admin@linagora.com                                                    |
| admin.password                            | Optional. Used by Twake mail to access the OpenPaaS API for its DAV extension.                                                                                                                                                                                                             | admin.password=xxxx                                                                  |
| alarm.event.scheduler.mode                | Optional. One of single, cluster, disabled. Controls the scheduling behaviour. In sindle this nodes runs all alarms and no inter-node leasing is attemptd, in disables the node proceses no alarms, in cluster, the node runs alarms, using a lease algorithm in order to avoid data races. | alarm.event.scheduler.mode=cluster                                                   |
| upload.user.total.limit | Optional. Defaulting to 50MB.  If exceeded then files are deleted in an oder first fashion to clear space until the upload can take place.                                                                                                                                                 | upload.user.total.limit=50MiB                                                        |
| upload.expiration | Optional. Defaulting to 1 hour. After this amount of time uploads are removed.                                                                                                                                                                                                             | upload.expiration=1h                                                                 |
Please find hereby a [working example](../../app/src/main/conf/configuration.properties).

## Notes on JWT key generation

`openssl` can be used to generate the aforementioned JWT keys:

```java
openssl genpkey -algorithm RSA -out jwt_privatekey -pkeyopt rsa_keygen_bits:2048
openssl rsa -pubout -in private.pem -out jwt_publickey
```